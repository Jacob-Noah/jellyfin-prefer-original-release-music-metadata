<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Prefer Original Release Music Metadata</title>
</head>
<body>
    <div id="PreferOriginalReleaseMusicMetadataConfigPage" data-role="page" class="page type-interior pluginConfigurationPage" data-require="emby-input,emby-button,emby-checkbox">
        <div data-role="content">
            <div class="content-primary">
                <form id="PreferOriginalReleaseMusicMetadataConfigForm">
                    <div class="verticalSection">
                        <h2>Prefer Original Release Music Metadata Configuration</h2>
                        <p>This plugin forces Jellyfin to prefer original release dates over standard release dates in music metadata.</p>
                        <p>The plugin recognizes the following metadata tags:</p>
                        <ul>
                            <li><strong>TDOR</strong>: ID3v2.4 Original Release Year tag (highest priority)</li>
                            <li><strong>OriginalReleaseDate</strong>: Custom field for full date information</li>
                            <li><strong>OriginalYear</strong>: Custom field for year-only information</li>
                            <li><strong>Original Date</strong>: Vorbis comment field for original release date</li>
                        </ul>
                        <p>After enabling this feature, run the "Apply Original Release Date Metadata" scheduled task to process your entire music library.</p>
                    </div>
                    
                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label>
                            <input type="checkbox" is="emby-checkbox" id="enablePreferOriginalRelease" />
                            <span>Enable Plugin</span>
                        </label>
                        <div class="fieldDescription">
                            Master toggle for the plugin. When enabled, the plugin will prefer original release dates over remaster/re-release dates in music metadata.
                            This must be enabled for both automatic processing and the scheduled task to work. By default, the scheduled task must be run manually - you must define a schedule on the <a href="#/dashboard/tasks">Scheduled Tasks</a> page if you want it to run automatically.
                        </div>
                    </div>

                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label>
                            <input type="checkbox" is="emby-checkbox" id="enableAutomaticProcessing" />
                            <span>Enable Automatic Processing</span>
                        </label>
                        <div class="fieldDescription">
                            When enabled, newly scanned or updated music items will be automatically processed to apply original release dates.
                            Disable this if you only want to use the manual scheduled task to process your library.
                        </div>
                    </div>

                    <div>
                        <button is="emby-button" type="submit" class="raised button-submit block">
                            <span>Save</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <script type="text/javascript">
            var PreferOriginalReleaseMusicMetadataConfig = {
                pluginUniqueId: '7c8df481-8eee-4b3a-9a3a-5c5e5e5e5e5e'
            };

            document.getElementById('PreferOriginalReleaseMusicMetadataConfigPage').addEventListener('pageshow', function () {
                Dashboard.showLoadingMsg();
                ApiClient.getPluginConfiguration(PreferOriginalReleaseMusicMetadataConfig.pluginUniqueId).then(function (config) {
                    document.getElementById('enablePreferOriginalRelease').checked = config.EnablePreferOriginalRelease;
                    document.getElementById('enableAutomaticProcessing').checked = config.EnableAutomaticProcessing;
                    Dashboard.hideLoadingMsg();
                });
            });

            document.getElementById('PreferOriginalReleaseMusicMetadataConfigForm').addEventListener('submit', function (e) {
                e.preventDefault();
                Dashboard.showLoadingMsg();

                ApiClient.getPluginConfiguration(PreferOriginalReleaseMusicMetadataConfig.pluginUniqueId).then(function (config) {
                    config.EnablePreferOriginalRelease = document.getElementById('enablePreferOriginalRelease').checked;
                    config.EnableAutomaticProcessing = document.getElementById('enableAutomaticProcessing').checked;

                    ApiClient.updatePluginConfiguration(PreferOriginalReleaseMusicMetadataConfig.pluginUniqueId, config).then(function () {
                        Dashboard.processPluginConfigurationUpdateResult();
                    });
                });

                return false;
            });
        </script>
    </div>
</body>
</html>
